<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <style>
    body {
      font-family: "Avenir", "Helvetica Neue", Helvetica, sans-serif;
      width: 100%;
    }
    svg.main {
      display: block;
      margin: 0 auto;
      margin-top: 30px;
    }
    h1, h2 {
      text-align: center;
      text-transform: uppercase;
    }
    h1 {
      font-size: 48px;
      margin-bottom: 30px;
    }
    h2 {
      font-size: 32px;
      color: #888;
    }
    .land {
      fill: #E0E3DA;
    }
    .border {
      fill: none;
      stroke: #fff;
      stroke-linejoin: round;
      stroke-linecap: round;
    }
    .bubble circle {
      fill: #EC7357;
      fill-opacity: 0.5;
      stroke: #fff;
      stroke-width: 0.4px;
    }
    .legend circle {
      fill: none;
      stroke: #ccc;
      stroke-width: 1px;
    }
    .legend text {
      fill: #777;
      font: 10px sans-serif;
      text-anchor: middle;
    }
  </style>
</head>
<body>
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>

  <div class="wrapper">
    <h1>Bubble Map</h1>
    <h2>US Population</h2>
  </div>

  <script>

    var width = 960;
    var height = 600;

    var path = d3.geo.path()
                 .projection(null);

    var svg = d3.select(".wrapper")
                .append("svg")
                .attr("class", "main")
                .attr("width", width)
                .attr("height", height);

    d3.json("us.json", function(error, us) {
      if (error) {
        return console.error(error);
      }

      var radius = d3.scale.sqrt()
                     .domain([0, 1e6])
                     .range([0, 15]);

      // Display base map
      svg.append("path")
         .datum(topojson.feature(us, us.objects.nation))
         .attr("class", "land")
         .attr("d", path);

      // Display state boundaries
      svg.append("path")
         .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
         .attr("class", "border border--state")
         .attr("d", path);

      // Display population bubble
      svg.append("g")
         .attr("class", "bubble")
         .selectAll("circle")
         .data(topojson.feature(us, us.objects.counties).features.sort(function(a, b) { return b.properties.population - a.properties.population; }))
         .enter().append("circle")
         .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
         .attr("r", function(d) { return radius(d.properties.population); });

      // Display legend
      var legend = svg.append("g")
                      .attr("class", "legend")
                      .attr("transform", "translate(" + (width - 50) + "," + (height - 20) + ")")
                      .selectAll("g")
                      .data([1e6, 3e6, 6e6])
                      .enter().append("g")
                      .attr("class", "bubble");

      legend.append("circle")
          .attr("cy", function(d) { return -radius(d); })
          .attr("r", radius);

      legend.append("text")
          .attr("y", function(d) { return -2 * radius(d); })
          .attr("dy", "1.3em")
          .text(d3.format(".1s"));

    });

  </script>
</body>
